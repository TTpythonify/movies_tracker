<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Tracker - Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Navbar -->
    <nav>
        <h1>Movie Tracker</h1>
        <ul>
            <li><a href="/">Watch Later ({{ watchlist_count }})</a></li>
            <li><a href="/">Watched ({{ watched_count }})</a></li>
            <li><a href="/">Notifications</a></li>
            <li><a href="/">Logout</a></li>
        </ul>
    </nav>

    <!-- Welcome message -->
    <section class="welcome">
        <h2>Welcome, {{ username }}!</h2>
        <p>Search for your favorite movies and start tracking them.</p>
    </section>

    <!-- Main content -->
    <main>
        <div class="search-movies-box">
            <!-- Search Bar -->
            <div class="search-bar">
                <form action="/homepage" method="POST">
                    <input type="text" name="query" placeholder="Search movies..." required>
                    <button type="submit">Search</button>
                </form>
            </div>

            <!-- Movie Results -->
            <div class="movie-results">
                {% if movies %}
                    {% for movie in movies %}
                        <div class="movie-card">
                            <!-- Poster -->
                            {% if movie.poster_url %}
                                <img src="{{ movie.poster_url }}" alt="{{ movie.title }} poster">
                            {% else %}
                                <div class="placeholder-poster">No Image</div>
                            {% endif %}
                            
                            <!-- Movie Info -->
                            <div>
                                <h3>{{ movie.title }}</h3>
                                <p class="release-date">Release: {{ movie.release_date or 'N/A' }}</p>
                                <p class="overview">{{ movie.overview or 'No overview available.' }}</p>
                                <p class="ratings">⭐ {{ movie.vote_average or 0 }} | Votes: {{ movie.vote_count or 0 }}</p>
                                <button onclick="openMovieModal('{{ movie.id }}')">Details</button>

                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-movies">No movies found. Start searching!</p>
                {% endif %}
            </div>

        </div>
    </main>
    <!-- Add this right before the closing </body> tag in homepage.html -->

<!-- Modal -->
<div id="movieModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modalBody">
            <!-- Movie details will be loaded here -->
            <div class="loading">Loading...</div>
        </div>
    </div>
</div>

<script>
    // Get modal elements
    const modal = document.getElementById('movieModal');
    const span = document.getElementsByClassName('close')[0];

    // Function to open modal and load movie details
    function openMovieModal(movieId) {
        modal.style.display = 'block';
        
        // Fetch movie details
        fetch(`/movie/${movieId}`)
            .then(response => response.json())
            .then(data => {
                displayMovieDetails(data);
            })
            .catch(error => {
                document.getElementById('modalBody').innerHTML = '<p>Error loading movie details.</p>';
            });
    }

    // Function to display movie details in modal
    function displayMovieDetails(movie) {
        const modalBody = document.getElementById('modalBody');
        modalBody.innerHTML = `
            <div class="modal-movie-details">
                ${movie.backdrop_url ? `<img src="${movie.backdrop_url}" alt="${movie.title}" class="modal-backdrop">` : ''}
                
                <div class="modal-info-container">
                    ${movie.poster_url ? `<img src="${movie.poster_url}" alt="${movie.title}" class="modal-poster">` : '<div class="placeholder-poster">No Image</div>'}
                    
                    <div class="modal-text-info">
                        <h2>${movie.title}</h2>
                        <p class="modal-tagline">${movie.tagline || ''}</p>
                        <p class="modal-release"><strong>Release Date:</strong> ${movie.release_date || 'N/A'}</p>
                        <p class="modal-runtime"><strong>Runtime:</strong> ${movie.runtime ? movie.runtime + ' minutes' : 'N/A'}</p>
                        <p class="modal-rating">⭐ ${movie.vote_average || 0} / 10 (${movie.vote_count || 0} votes)</p>
                        <p class="modal-genres"><strong>Genres:</strong> ${movie.genres || 'N/A'}</p>
                        <p class="modal-overview"><strong>Overview:</strong><br>${movie.overview || 'No overview available.'}</p>
                        
                        <div class="modal-actions">
                            <button class="btn-watchlist" onclick="addToWatchlist(${movie.id})">Add to Watch Later</button>
                            <button class="btn-watched" onclick="addToWatched(${movie.id})">Mark as Watched</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // Close modal when X is clicked
    span.onclick = function() {
        modal.style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }

    // Placeholder functions for watchlist/watched
    function addToWatchlist(movieId) {
        // You'll implement this later
        alert('Added to watchlist: ' + movieId);
    }

    function addToWatched(movieId) {
        // You'll implement this later
        alert('Marked as watched: ' + movieId);
    }
</script>
</body>
</html>
